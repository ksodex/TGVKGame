import { Button } from "../components/Button"
import { PanelHeader } from "@vkontakte/vkui"
import { useState } from "react"

const levels = [
    { code: 4, levelName: "Детский", description: "По 4 карточки на столе" },
    { code: 6, levelName: "Простой", description: "По 6 карточки на столе" },
    { code: 12, levelName: "Средний", description: "По 12 карточки на столе" },
    { code: 16, levelName: "Сложный", description: "По 16 карточки на столе" },
    { code: 20, levelName: "Хардкор", description: "По 20 карточки на столе" },
    { code: 24, levelName: "Для профи", description: "По 24 карточки на столе" }
]

const getGridSize = (level) => {
    switch (level) {
        case 4: return { rows: 2, columns: 2 }
        case 6: return { rows: 2, columns: 3 }
        case 12: return { rows: 4, columns: 3 }
        case 16: return { rows: 4, columns: 4 }
        case 20: return { rows: 5, columns: 4 }
        case 24: return { rows: 6, columns: 4 }
        default: return { rows: 4, columns: 4 }
    }
}

const createGrid = (rows, columns) => {
    const totalCards = rows * columns
    return new Array(totalCards).fill('?')
}



export const MemoryGame = () => {
    const [isGameStarted, setIsGameStarted] = useState(false)
    const [flippedCards, setFlippedCards] = useState([])
    const [selectedLevel, setSelectedLevel] = useState(0)

    const { rows, columns } = getGridSize(selectedLevel)
    const grid = createGrid(rows, columns)

    const handleClick = (index) => {
        if (flippedCards.includes(index)) {
            setFlippedCards(flippedCards.filter((id) => id !== index));  // Если карточка уже перевернута, то вернуть в исходное положение
        } else {
            setFlippedCards([...flippedCards, index]);  // Иначе перевернуть карточку
        }
    };

    return <main className="bg-[#f1f3f5] min-h-screen space-y-4">
        <PanelHeader separator={true}>
            <span className="flex justify-center text-md text-[#FF4800]">Мемори</span>
        </PanelHeader>

        <section>
            {
                !isGameStarted ?
                    <div>
                        <h1 className="text-3xl text-center font-bold">Уровень сложности</h1>

                        <div className="flex flex-col space-y-3 p-2 m-2">
                            {levels.map((item, index) => (
                                <div
                                    className={`${selectedLevel === item.code ? "bg-[#430B51] text-white" : "bg-white"} rounded-xl p-2`}
                                    onClick={() => setSelectedLevel(item.code)}
                                    key={index}
                                >
                                    <h1 className={`${selectedLevel === item.code ? "text-white" : "text-[#FF4800]"} font-semibold`}>{item.levelName}</h1>
                                    <p>{item.description}</p>
                                </div>
                            ))}
                        </div>

                        <div className="flex gap-4">
                            <Button
                                onClick={() => { setIsGameStarted(true) }}
                                isFulled
                            >
                                <svg width="16" height="12" viewBox="0 0 16 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M10.4285 0.535767C14.2969 0.535767 15.8928 3.55031 15.8928 7.21434C15.8928 9.93501 15.1281 11.4643 13.4643 11.4643C12.7716 11.4643 12.3126 11.1722 11.7896 10.5577L11.6907 10.4386C11.635 10.37 11.4164 10.0935 11.3614 10.0258L11.2663 9.91133C10.7332 9.28516 10.2902 9.03577 9.51783 9.03577H6.48212C5.70976 9.03577 5.26677 9.28516 4.73369 9.91133L4.6386 10.0258C4.58357 10.0935 4.36498 10.37 4.3092 10.4386L4.21032 10.5577C3.6873 11.1722 3.22839 11.4643 2.53569 11.4643C0.871684 11.4643 0.107117 9.9352 0.107117 7.21434C0.107117 3.55031 1.70305 0.535767 5.5714 0.535767H10.4285ZM10.4285 1.75005H5.5714C2.58261 1.75005 1.3214 4.13234 1.3214 7.21434C1.3214 9.35062 1.77112 10.2501 2.53569 10.2501C2.79097 10.2501 2.97931 10.1322 3.28721 9.76893L3.6255 9.3482L3.8032 9.13123C4.55179 8.25094 5.2947 7.82148 6.48212 7.82148H9.51783C10.7053 7.82148 11.4482 8.25094 12.1967 9.13123L12.3038 9.26005L12.7127 9.76893C13.0206 10.1322 13.209 10.2501 13.4643 10.2501C14.2287 10.2501 14.6785 9.35043 14.6785 7.21434C14.6785 4.13234 13.4173 1.75005 10.4285 1.75005ZM5.27528 3.26791C5.39138 3.26791 5.48663 3.29045 5.56578 3.33278C5.64493 3.37512 5.70705 3.43724 5.74938 3.51639C5.79172 3.59554 5.81426 3.69079 5.81426 3.80689L5.81365 4.5423L6.55028 4.54291C6.66638 4.54291 6.76163 4.56545 6.84078 4.60778C6.91993 4.65012 6.98205 4.71224 7.02438 4.79139C7.06672 4.87054 7.08926 4.96579 7.08926 5.08189V5.09679C7.08926 5.21288 7.06672 5.30813 7.02438 5.38729C6.98205 5.46644 6.91993 5.52856 6.84078 5.57089C6.76163 5.61322 6.66638 5.63577 6.55028 5.63577L5.81365 5.63516L5.81426 6.37179C5.81426 6.48788 5.79172 6.58313 5.74938 6.66229C5.70705 6.74144 5.64493 6.80356 5.56578 6.84589C5.48663 6.88822 5.39138 6.91077 5.27528 6.91077H5.26038C5.14428 6.91077 5.04904 6.88822 4.96988 6.84589C4.89073 6.80356 4.82861 6.74144 4.78628 6.66229C4.74395 6.58313 4.7214 6.48788 4.7214 6.37179L4.7208 5.63516L3.98538 5.63577C3.86928 5.63577 3.77404 5.61322 3.69488 5.57089C3.61573 5.52856 3.55361 5.46644 3.51128 5.38729C3.46895 5.30813 3.4464 5.21288 3.4464 5.09679V5.08189C3.4464 4.96579 3.46895 4.87054 3.51128 4.79139C3.55361 4.71224 3.61573 4.65012 3.69488 4.60778C3.77404 4.56545 3.86928 4.54291 3.98538 4.54291L4.7208 4.5423L4.7214 3.80689C4.7214 3.69079 4.74395 3.59554 4.78628 3.51639C4.82861 3.43724 4.89073 3.37512 4.96988 3.33278C5.04904 3.29045 5.14428 3.26791 5.26038 3.26791H5.27528ZM10.7768 5.69648C10.9211 5.69648 11.0116 5.71902 11.0908 5.76136C11.1699 5.80369 11.2321 5.86581 11.2744 5.94496C11.3167 6.02411 11.3393 6.11467 11.3393 6.25893V6.34832C11.3393 6.49258 11.3167 6.58313 11.2744 6.66229C11.2321 6.74144 11.1699 6.80356 11.0908 6.84589C11.0116 6.88822 10.9211 6.91077 10.7768 6.91077H10.6874C10.5432 6.91077 10.4526 6.88822 10.3735 6.84589C10.2943 6.80356 10.2322 6.74144 10.1898 6.66229C10.1475 6.58313 10.125 6.49258 10.125 6.34832V6.25893C10.125 6.11467 10.1475 6.02411 10.1898 5.94496C10.2322 5.86581 10.2943 5.80369 10.3735 5.76136C10.4526 5.71902 10.5432 5.69648 10.6874 5.69648H10.7768ZM9.56253 4.4822C9.70679 4.4822 9.79734 4.50474 9.87649 4.54707C9.95565 4.5894 10.0178 4.65152 10.0601 4.73068C10.1024 4.80983 10.125 4.90038 10.125 5.04464V5.13404C10.125 5.27829 10.1024 5.36885 10.0601 5.448C10.0178 5.52715 9.95565 5.58927 9.87649 5.63161C9.79734 5.67394 9.70679 5.69648 9.56253 5.69648H9.47313C9.32888 5.69648 9.23832 5.67394 9.15917 5.63161C9.08002 5.58927 9.0179 5.52715 8.97556 5.448C8.93323 5.36885 8.91069 5.27829 8.91069 5.13404V5.04464C8.91069 4.90038 8.93323 4.80983 8.97556 4.73068C9.0179 4.65152 9.08002 4.5894 9.15917 4.54707C9.23832 4.50474 9.32888 4.4822 9.47313 4.4822H9.56253ZM11.9911 4.4822C12.1354 4.4822 12.2259 4.50474 12.3051 4.54707C12.3842 4.5894 12.4463 4.65152 12.4887 4.73068C12.531 4.80983 12.5535 4.90038 12.5535 5.04464V5.13404C12.5535 5.27829 12.531 5.36885 12.4887 5.448C12.4463 5.52715 12.3842 5.58927 12.3051 5.63161C12.2259 5.67394 12.1354 5.69648 11.9911 5.69648H11.9017C11.7574 5.69648 11.6669 5.67394 11.5877 5.63161C11.5086 5.58927 11.4465 5.52715 11.4041 5.448C11.3618 5.36885 11.3393 5.27829 11.3393 5.13404V5.04464C11.3393 4.90038 11.3618 4.80983 11.4041 4.73068C11.4465 4.65152 11.5086 4.5894 11.5877 4.54707C11.6669 4.50474 11.7574 4.4822 11.9017 4.4822H11.9911ZM10.7768 3.26791C10.9211 3.26791 11.0116 3.29045 11.0908 3.33278C11.1699 3.37512 11.2321 3.43724 11.2744 3.51639C11.3167 3.59554 11.3393 3.6861 11.3393 3.83035V3.91975C11.3393 4.06401 11.3167 4.15456 11.2744 4.23371C11.2321 4.31287 11.1699 4.37499 11.0908 4.41732C11.0116 4.45965 10.9211 4.4822 10.7768 4.4822H10.6874C10.5432 4.4822 10.4526 4.45965 10.3735 4.41732C10.2943 4.37499 10.2322 4.31287 10.1898 4.23371C10.1475 4.15456 10.125 4.06401 10.125 3.91975V3.83035C10.125 3.6861 10.1475 3.59554 10.1898 3.51639C10.2322 3.43724 10.2943 3.37512 10.3735 3.33278C10.4526 3.29045 10.5432 3.26791 10.6874 3.26791H10.7768Z" fill="white" />
                                </svg>
                                Играть
                            </Button>

                            <Button>
                                <svg width="15" height="16" viewBox="0 0 15 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M7.50001 0.714233C11.5238 0.714233 14.7857 3.97616 14.7857 7.99995C14.7857 12.0237 11.5238 15.2857 7.50001 15.2857C3.47622 15.2857 0.214294 12.0237 0.214294 7.99995C0.214294 3.97616 3.47622 0.714233 7.50001 0.714233ZM7.50001 1.92852C4.14685 1.92852 1.42858 4.64679 1.42858 7.99995C1.42858 11.3531 4.14685 14.0714 7.50001 14.0714C10.8532 14.0714 13.5714 11.3531 13.5714 7.99995C13.5714 4.64679 10.8532 1.92852 7.50001 1.92852ZM7.54471 6.78566C7.68896 6.78566 7.77952 6.80821 7.85867 6.85054C7.93782 6.89287 7.99994 6.95499 8.04228 7.03414C8.08461 7.1133 8.10715 7.20385 8.10715 7.34811V11.0804C8.10715 11.2246 8.08461 11.3152 8.04228 11.3943C7.99994 11.4735 7.93782 11.5356 7.85867 11.5779C7.77952 11.6203 7.68896 11.6428 7.54471 11.6428H7.45531C7.31105 11.6428 7.2205 11.6203 7.14135 11.5779C7.06219 11.5356 7.00007 11.4735 6.95774 11.3943C6.91541 11.3152 6.89287 11.2246 6.89287 11.0804V7.34811C6.89287 7.20385 6.91541 7.1133 6.95774 7.03414C7.00007 6.95499 7.06219 6.89287 7.14135 6.85054C7.2205 6.80821 7.31105 6.78566 7.45531 6.78566H7.54471ZM7.50001 4.11423C7.96945 4.11423 8.35001 4.49479 8.35001 4.96423C8.35001 5.43368 7.96945 5.81423 7.50001 5.81423C7.03057 5.81423 6.65001 5.43368 6.65001 4.96423C6.65001 4.49479 7.03057 4.11423 7.50001 4.11423Z" fill="white" />
                                </svg>
                            </Button>
                        </div>
                    </div> :

                    <div className="space-y-5">
                        <div className="flex justify-center space-x-5 *:flex *:items-center *:space-x-2 *:rounded-2xl *:border *:border-[#FF4800] *:p-2">
                            <div>
                                <svg width="15" height="16" viewBox="0 0 15 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M14.6396 11.6987C14.5224 13.9353 11.3222 15.5 7.50003 15.5C3.60576 15.5 0.357178 13.8757 0.357178 11.5714V4.42857L0.360503 4.30126C0.477717 2.06469 3.67787 0.5 7.50003 0.5C11.3943 0.5 14.6429 2.12429 14.6429 4.42857V11.5714L14.6396 11.6987ZM13.2151 6.8325C11.9033 7.78273 9.81586 8.35714 7.50003 8.35714C5.18463 8.35714 3.09749 7.78294 1.78569 6.83302L1.78575 8C1.78575 9.24612 4.29351 10.5 7.50003 10.5C10.7066 10.5 13.2143 9.24612 13.2143 8L13.2151 6.8325ZM7.50003 1.92857C4.29351 1.92857 1.78575 3.18245 1.78575 4.42857C1.78575 5.67469 4.29351 6.92857 7.50003 6.92857C10.7066 6.92857 13.2143 5.67469 13.2143 4.42857C13.2143 3.18245 10.7066 1.92857 7.50003 1.92857ZM13.2151 10.4039C11.9033 11.3542 9.81586 11.9286 7.50003 11.9286C5.18463 11.9286 3.09749 11.3544 1.78569 10.4045L1.78575 11.5714L1.78944 11.6545C1.89755 12.8727 4.36476 14.0714 7.50003 14.0714C10.7066 14.0714 13.2143 12.8175 13.2143 11.5714L13.2151 10.4039Z" fill="#FF4800" />
                                </svg>
                                <span className="text-[#FF4800]">200</span>
                            </div>
                            <div>
                                <svg width="19" height="18" viewBox="0 0 19 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fillRule="evenodd" clipRule="evenodd" d="M5.93462 3.64166C6.00409 4.03554 5.74486 4.41182 5.35563 4.48212C4.01283 4.72462 3.51578 4.85775 3.18557 5.10955C2.82334 5.38576 2.55683 5.77092 2.42422 6.20983C2.36235 6.41459 2.34059 6.67424 2.38096 7.11221C2.42212 7.55863 2.52006 8.12399 2.66136 8.93489L3.30781 12.6448C3.44911 13.4557 3.54816 14.0208 3.66037 14.4546C3.77046 14.8801 3.87867 15.1166 4.00602 15.2876C4.27898 15.6541 4.6596 15.9238 5.09334 16.058C5.28948 16.1187 5.53701 16.1413 5.94701 16.1052C6.36533 16.0684 6.89374 15.9771 7.64658 15.8429C8.03597 15.7735 8.40724 16.0367 8.47583 16.4307C8.54441 16.8248 8.28435 17.2005 7.89496 17.2699C7.16103 17.4007 6.56495 17.5052 6.07103 17.5487C5.56879 17.5929 5.11633 17.5802 4.67472 17.4436C3.95182 17.2199 3.31744 16.7704 2.86251 16.1595C2.57611 15.7749 2.40782 15.334 2.27523 14.8215C2.14645 14.3238 2.03779 13.7001 1.90306 12.9269L1.24597 9.15595C1.11123 8.38274 1.00255 7.75908 0.955329 7.24678C0.906705 6.7193 0.915822 6.24674 1.05496 5.78621C1.27597 5.0547 1.72017 4.41276 2.32388 3.95241C2.98393 3.4491 3.86854 3.27889 5.10407 3.05576C5.49331 2.98547 5.86516 3.24779 5.93462 3.64166Z" fill="#FF4800" />
                                    <path fillRule="evenodd" clipRule="evenodd" d="M13.2802 0.749754L13.4816 0.785683C14.2457 0.922015 14.862 1.03198 15.3539 1.16229C15.8604 1.29646 16.2961 1.46676 16.6762 1.75657C17.2799 2.21692 17.7241 2.85886 17.9451 3.59037C18.0842 4.0509 18.0933 4.52346 18.0447 5.05094C17.9975 5.56325 17.8888 6.1869 17.7541 6.96012L17.097 10.731C16.9622 11.5043 16.8536 12.1279 16.7248 12.6257C16.5922 13.1382 16.4239 13.5791 16.1375 13.9637C15.6826 14.5746 15.0482 15.0241 14.3253 15.2477C13.8702 15.3885 13.4032 15.3978 12.882 15.3485C12.3757 15.3008 11.7594 15.1908 10.9953 15.0544L10.7939 15.0185C10.0298 14.8822 9.41348 14.7722 8.92159 14.6419C8.41513 14.5077 7.97941 14.3374 7.59935 14.0476C6.99563 13.5873 6.55144 12.9453 6.33043 12.2138C6.19129 11.7533 6.18217 11.2807 6.2308 10.7533C6.27802 10.241 6.3867 9.6173 6.52144 8.84409L7.17853 5.07313C7.31325 4.29992 7.42192 3.67626 7.5507 3.17851C7.68329 2.66601 7.85158 2.22511 8.13798 1.84051C8.59291 1.2296 9.22729 0.780113 9.95018 0.556467C10.4053 0.415669 10.8723 0.406444 11.3935 0.455648C11.8998 0.503435 12.5161 0.613408 13.2802 0.749754ZM11.2606 1.89827C10.8278 1.85742 10.5712 1.87944 10.3688 1.94205C9.93507 2.07623 9.55445 2.34592 9.28149 2.71247C9.15414 2.88348 9.04593 3.11994 8.93584 3.54546C8.82362 3.9792 8.72458 4.54437 8.58328 5.35527L7.93683 9.06515C7.79553 9.87604 7.69758 10.4414 7.65643 10.8878C7.61606 11.3258 7.63782 11.5854 7.69969 11.7902C7.83229 12.2291 8.09881 12.6143 8.46104 12.8905C8.63003 13.0194 8.86371 13.1289 9.28422 13.2403C9.71285 13.3538 10.2714 13.454 11.0727 13.597L11.2137 13.6222C12.0151 13.7652 12.5738 13.8643 13.0149 13.9059C13.4477 13.9468 13.7043 13.9248 13.9067 13.8622C14.3404 13.728 14.7211 13.4583 14.994 13.0917C15.1214 12.9207 15.2296 12.6843 15.3397 12.2587C15.4519 11.825 15.5509 11.2598 15.6922 10.4489L16.3387 6.73905C16.48 5.92815 16.5779 5.36279 16.6191 4.91637C16.6594 4.4784 16.6377 4.21875 16.5758 4.01398C16.4432 3.57508 16.1767 3.18991 15.8145 2.9137C15.6455 2.78484 15.4118 2.67534 14.9913 2.56394C14.5626 2.45038 14.0041 2.35016 13.2028 2.20717L13.0618 2.18201C12.2604 2.03903 11.7017 1.93991 11.2606 1.89827Z" fill="#FF4800" />
                                </svg>
                                <span className="text-[#FF4800]">6</span>
                            </div>
                            <div>
                                <svg width="19" height="18" viewBox="0 0 19 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M9.50002 0.428589C14.2328 0.428589 18.0714 4.26595 18.0714 9.00002C18.0714 13.7341 14.2328 17.5714 9.50002 17.5714C4.76595 17.5714 0.928589 13.7341 0.928589 9.00002C0.928589 4.26595 4.76595 0.428589 9.50002 0.428589ZM9.50002 1.85716C5.55493 1.85716 2.35716 5.05493 2.35716 9.00002C2.35716 12.9451 5.55493 16.1429 9.50002 16.1429C13.4443 16.1429 16.6429 12.9446 16.6429 9.00002C16.6429 5.05542 13.4443 1.85716 9.50002 1.85716ZM9.14287 4.71436C9.53736 4.71436 9.85716 5.03416 9.85716 5.42865V9.07407L13.339 10.4806C13.7048 10.6284 13.8815 11.0447 13.7337 11.4105C13.586 11.7763 13.1697 11.953 12.8039 11.8052L8.87533 10.2182C8.60534 10.1091 8.42859 9.84707 8.42859 9.55589V5.42865C8.42859 5.03416 8.74838 4.71436 9.14287 4.71436Z" fill="#FF4800" />
                                </svg>
                                <span className="text-[#FF4800]">01:53</span>
                            </div>
                        </div>

                        <div className="grid gap-4" style={{ gridTemplateColumns: `repeat(${columns}, 1fr)` }}>
                            {grid.map((card, index) => (
                                <div
                                    key={index}
                                    className="border-2 p-4 flex justify-center items-center text-lg aspect-square cursor-pointer"
                                    onClick={() => handleClick(index)}
                                    style={{
                                        perspective: "1000px", // Создаем перспективу для 3D эффектов
                                    }}
                                >
                                    <div
                                        className={`relative w-full h-full transform transition-transform duration-500 ${flippedCards.includes(index) ? "rotate-x-180" : ""
                                            }`}
                                        style={{
                                            transformStyle: "preserve-3d", // Включаем 3D-преобразования
                                        }}
                                    >
                                        {/* Передняя сторона карточки */}
                                        <div
                                            className="absolute w-full h-full bg-blue-500 flex justify-center items-center text-white backface-hidden"
                                        >
                                            {card.front}
                                        </div>

                                        {/* Задняя сторона карточки */}
                                        <div
                                            className="absolute w-full h-full bg-green-500 flex justify-center items-center text-white rotate-x-180 backface-hidden"
                                        >
                                            {card.back}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
            }
        </section>
    </main>
}

export default MemoryGame
